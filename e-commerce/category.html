<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoEssentials - Products</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Additional styles specific to the category page */
    .category-header {
      padding: 2rem 0;
      background-color: #f0f7f0;
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .filter-sidebar {
      background-color: #fff;
      padding: 1.5rem;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .filter-group {
      margin-bottom: 1.5rem;
    }
    
    .filter-group h3 {
      margin-bottom: 1rem;
      font-size: 1.125rem;
    }
    
    .filter-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .filter-checkbox {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .range-slider {
      margin-top: 1rem;
    }
    
    .price-inputs {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
    }
    
    .price-inputs input {
      width: 45%;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
    }
    
    .filter-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    
    .products-container {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 2rem;
    }
    
    .products-main {
      width: 100%;
    }
    
    .products-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .products-count {
      font-size: 0.875rem;
      color: var(--text-muted);
    }
    
    .mobile-filter-toggle {
      display: none;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .breadcrumbs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      color: var(--text-muted);
    }
    
    .breadcrumbs a {
      color: var(--text-muted);
    }
    
    .breadcrumbs a:hover {
      color: var(--primary-color);
    }
    
    .breadcrumbs .separator {
      margin: 0 0.25rem;
    }
    
    .no-results {
      text-align: center;
      padding: 3rem 0;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 2rem;
    }
    
    .pagination-button {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      background-color: var(--text-light);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .pagination-button:hover, .pagination-button.active {
      background-color: var(--primary-color);
      color: var(--text-light);
      border-color: var(--primary-color);
    }
    
    @media (max-width: 992px) {
      .products-container {
        grid-template-columns: 1fr;
      }
      
      .filter-sidebar {
        display: none;
        margin-bottom: 1.5rem;
      }
      
      .filter-sidebar.active {
        display: block;
      }
      
      .mobile-filter-toggle {
        display: flex;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="header-top">
        <div class="logo">
          <a href="index.html"><span class="eco">Eco</span>Essentials</a>
        </div>
        <div class="search-bar">
          <form id="search-form">
            <input type="text" placeholder="Search sustainable products..." id="search-input">
            <button type="submit"><i class="fas fa-search"></i></button>
          </form>
        </div>
        <nav class="header-nav">
          <ul>
            <li><a href="wishlist.html"><i class="fas fa-heart"></i> <span>Wishlist</span></a></li>
            <li><a href="marketplace.html"><span>Marketplace</span></a></li>
            <li><a href="account.html"><i class="fas fa-user"></i> <span>Account</span></a></li>
            <li><a href="cart.html"><i class="fas fa-shopping-bag"></i> <span>Cart</span> <span class="cart-count">0</span></a></li>
          </ul>
        </nav>
        <button class="mobile-menu-toggle">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      <nav class="categories-nav">
        <ul id="categories-list">
          <li><a href="category.html?id=all" class="active" data-category="all">All Products</a></li>
          <!-- Categories will be populated here by JavaScript -->
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="category-header">
      <div class="container">
        <h1 id="category-title">All Products</h1>
        <div class="breadcrumbs">
          <a href="index.html">Home</a>
          <span class="separator">/</span>
          <span id="breadcrumb-category">All Products</span>
        </div>
      </div>
    </div>
    
    <div class="container">
      <button class="mobile-filter-toggle btn btn-outline">
        <i class="fas fa-filter"></i> Show Filters
      </button>
      
      <div class="products-container">
        <aside class="filter-sidebar">
          <div class="filter-group">
            <h3>Sustainability Features</h3>
            <div class="filter-options" id="sustainability-filters">
              <!-- Sustainability filters will be populated here -->
            </div>
          </div>
          
          <div class="filter-group">
            <h3>Eco-Impact Score</h3>
            <div class="range-slider">
              <input type="range" min="0" max="100" value="0" class="slider" id="eco-impact-slider">
              <div class="price-inputs">
                <span>Min: <span id="eco-impact-value">0</span>/100</span>
              </div>
            </div>
          </div>
          
          <div class="filter-group">
            <h3>Price Range</h3>
            <div class="price-inputs">
              <input type="number" id="min-price" placeholder="Min" min="0">
              <input type="number" id="max-price" placeholder="Max" min="0">
            </div>
          </div>
          
          <div class="filter-buttons">
            <button class="btn btn-primary" id="apply-filters">Apply Filters</button>
            <button class="btn btn-outline" id="clear-filters">Clear All</button>
          </div>
        </aside>
        
        <div class="products-main">
          <div class="products-header">
            <div class="products-count"><span id="products-count">0</span> products found</div>
            <div class="sort-filter">
              <select id="sort-select">
                <option value="featured">Sort by Featured</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="newest">Newest Arrivals</option>
                <option value="eco-score">Eco-Impact Score</option>
              </select>
            </div>
          </div>
          
          <div class="products-grid" id="products-grid">
            <!-- Products will be populated here by JavaScript -->
          </div>
          
          <div id="no-results" class="no-results" style="display: none;">
            <h3>No products found</h3>
            <p>Try adjusting your filters or search criteria</p>
          </div>
          
          <div class="pagination" id="pagination">
            <!-- Pagination will be populated here by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h3>EcoEssentials</h3>
          <p>Sustainable products for a better world. Supporting rural artisans and eco-friendly practices.</p>
        </div>
        <div class="footer-column">
          <h3>Shop</h3>
          <ul>
            <li><a href="category.html?id=all">All Products</a></li>
            <li><a href="category.html?id=fashion">Sustainable Fashion</a></li>
            <li><a href="category.html?id=home">Home & Living</a></li>
            <li><a href="category.html?id=personal-care">Personal Care</a></li>
            <li><a href="category.html?id=food">Food & Drinks</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>About</h3>
          <ul>
            <li><a href="about.html">Our Mission</a></li>
            <li><a href="artisans.html">Meet the Artisans</a></li>
            <li><a href="sustainability.html">Sustainability Pledge</a></li>
            <li><a href="contact.html">Contact Us</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Connect With Us</h3>
          <div class="social-links">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-pinterest-p"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 EcoEssentials. All rights reserved.</p>
        <div class="footer-links">
          <a href="privacy.html">Privacy Policy</a>
          <a href="terms.html">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="data.js"></script>
  <script src="script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize category page
      initCategoryPage();
    });

    function initCategoryPage() {
      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const categoryId = urlParams.get('id');
      const searchQuery = urlParams.get('search');
      const sortOption = urlParams.get('sort') || 'featured';
      
      // Initialize the page
      populateCategories();
      initMobileMenu();
      
      // Set active category in navigation
      setActiveCategory(categoryId);
      
      // Populate category title and breadcrumb
      setCategoryTitle(categoryId, searchQuery);
      
      // Set sort select value
      document.getElementById('sort-select').value = sortOption;
      
      // Populate sustainability filters
      populateSustainabilityFilters();
      
      // Initialize filter functionality
      initFilters();
      
      // Load products
      loadProducts(categoryId, searchQuery, sortOption);
      
      // Initialize event listeners
      initCategoryEventListeners();
    }

    function setActiveCategory(categoryId) {
      // Remove active class from all category links
      const categoryLinks = document.querySelectorAll('.categories-nav a');
      categoryLinks.forEach(link => link.classList.remove('active'));
      
      // Set active class on the current category link
      const activeLink = document.querySelector(`.categories-nav a[data-category="${categoryId}"]`);
      if (activeLink) {
        activeLink.classList.add('active');
      }
    }

    function setCategoryTitle(categoryId, searchQuery) {
      const categoryTitleElement = document.getElementById('category-title');
      const breadcrumbCategoryElement = document.getElementById('breadcrumb-category');
      
      let title = 'All Products';
      
      if (categoryId && categoryId !== 'all') {
        const category = categories.find(c => c.slug === categoryId);
        if (category) {
          title = category.name;
        }
      }
      
      if (searchQuery) {
        title = `Search results for "${searchQuery}"`;
      }
      
      categoryTitleElement.textContent = title;
      breadcrumbCategoryElement.textContent = title;
    }

    function populateSustainabilityFilters() {
      const sustainabilityFiltersContainer = document.getElementById('sustainability-filters');
      
      // Get unique sustainability badges
      const uniqueBadges = new Set();
      products.forEach(product => {
        if (product.sustainabilityBadges) {
          product.sustainabilityBadges.forEach(badge => {
            uniqueBadges.add(JSON.stringify({
              name: badge.name,
              color: badge.color,
              description: badge.description
            }));
          });
        }
      });
      
      // Create filter options
      Array.from(uniqueBadges).forEach(badgeJson => {
        const badge = JSON.parse(badgeJson);
        const div = document.createElement('div');
        div.className = 'filter-checkbox';
        div.innerHTML = `
          <input type="checkbox" id="badge-${badge.name.toLowerCase()}" data-badge="${badge.name}">
          <label for="badge-${badge.name.toLowerCase()}">
            <span class="badge" style="background-color: ${badge.color}" title="${badge.description}">${badge.name}</span>
          </label>
        `;
        sustainabilityFiltersContainer.appendChild(div);
      });
    }

    function initFilters() {
      // Eco-impact slider
      const slider = document.getElementById('eco-impact-slider');
      const ecoImpactValue = document.getElementById('eco-impact-value');
      
      slider.addEventListener('input', function() {
        ecoImpactValue.textContent = this.value;
      });
      
      // Apply filters button
      document.getElementById('apply-filters').addEventListener('click', function() {
        applyFilters();
      });
      
      // Clear filters button
      document.getElementById('clear-filters').addEventListener('click', function() {
        clearFilters();
      });
      
      // Mobile filter toggle
      document.querySelector('.mobile-filter-toggle').addEventListener('click', function() {
        const filterSidebar = document.querySelector('.filter-sidebar');
        filterSidebar.classList.toggle('active');
        
        if (filterSidebar.classList.contains('active')) {
          this.innerHTML = '<i class="fas fa-times"></i> Hide Filters';
        } else {
          this.innerHTML = '<i class="fas fa-filter"></i> Show Filters';
        }
      });
    }

    function loadProducts(categoryId, searchQuery, sortOption, filters = {}) {
      // Filter products
      let filteredProducts = products;
      
      // Filter by category
      if (categoryId && categoryId !== 'all') {
        const category = categories.find(c => c.slug === categoryId);
        if (category) {
          filteredProducts = filteredProducts.filter(product => product.categoryId === category.id);
        }
      }
      
      // Filter by search query
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filteredProducts = filteredProducts.filter(product => 
          product.name.toLowerCase().includes(query) || 
          product.description.toLowerCase().includes(query)
        );
      }
      
      // Apply additional filters
      if (filters.badges && filters.badges.length > 0) {
        filteredProducts = filteredProducts.filter(product => {
          if (!product.sustainabilityBadges) return false;
          return filters.badges.some(badge => 
            product.sustainabilityBadges.some(productBadge => 
              productBadge.name === badge
            )
          );
        });
      }
      
      if (filters.minEcoImpact > 0) {
        filteredProducts = filteredProducts.filter(product => 
          product.ecoImpact >= filters.minEcoImpact
        );
      }
      
      if (filters.minPrice !== undefined && filters.minPrice > 0) {
        filteredProducts = filteredProducts.filter(product => 
          product.price >= filters.minPrice
        );
      }
      
      if (filters.maxPrice !== undefined && filters.maxPrice > 0) {
        filteredProducts = filteredProducts.filter(product => 
          product.price <= filters.maxPrice
        );
      }
      
      // Sort products
      sortProducts(filteredProducts, sortOption);
      
      // Update products count
      document.getElementById('products-count').textContent = filteredProducts.length;
      
      // Show or hide no results message
      const noResultsElement = document.getElementById('no-results');
      const productsGridElement = document.getElementById('products-grid');
      
      if (filteredProducts.length === 0) {
        noResultsElement.style.display = 'block';
        productsGridElement.style.display = 'none';
      } else {
        noResultsElement.style.display = 'none';
        productsGridElement.style.display = 'grid';
      }
      
      // Populate products grid
      populateProductsGrid(filteredProducts);
    }

    function sortProducts(products, sortOption) {
      switch (sortOption) {
        case 'price-low':
          products.sort((a, b) => a.price - b.price);
          break;
        case 'price-high':
          products.sort((a, b) => b.price - a.price);
          break;
        case 'eco-score':
          products.sort((a, b) => b.ecoImpact - a.ecoImpact);
          break;
        // For 'newest' and 'featured', we could add more logic, but for now
        // we'll use the product ID as a proxy for newness
        case 'newest':
          products.sort((a, b) => b.id - a.id);
          break;
        case 'featured':
        default:
          // Sort featured products first, then by ID
          products.sort((a, b) => {
            if (a.featured && !b.featured) return -1;
            if (!a.featured && b.featured) return 1;
            return b.id - a.id;
          });
          break;
      }
    }

    function populateProductsGrid(filteredProducts) {
      const productsGrid = document.getElementById('products-grid');
      productsGrid.innerHTML = '';
      
      filteredProducts.forEach(product => {
        productsGrid.appendChild(createProductCard(product));
      });
    }

    function applyFilters() {
      // Get selected badge filters
      const badgeCheckboxes = document.querySelectorAll('#sustainability-filters input:checked');
      const selectedBadges = Array.from(badgeCheckboxes).map(checkbox => checkbox.dataset.badge);
      
      // Get eco-impact minimum
      const minEcoImpact = parseInt(document.getElementById('eco-impact-slider').value);
      
      // Get price range
      const minPrice = parseFloat(document.getElementById('min-price').value) || undefined;
      const maxPrice = parseFloat(document.getElementById('max-price').value) || undefined;
      
      // Create filters object
      const filters = {
        badges: selectedBadges,
        minEcoImpact: minEcoImpact,
        minPrice: minPrice,
        maxPrice: maxPrice
      };
      
      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const categoryId = urlParams.get('id');
      const searchQuery = urlParams.get('search');
      const sortOption = urlParams.get('sort') || 'featured';
      
      // Load products with filters
      loadProducts(categoryId, searchQuery, sortOption, filters);
    }

    function clearFilters() {
      // Reset badge checkboxes
      const badgeCheckboxes = document.querySelectorAll('#sustainability-filters input');
      badgeCheckboxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // Reset eco-impact slider
      const slider = document.getElementById('eco-impact-slider');
      slider.value = 0;
      document.getElementById('eco-impact-value').textContent = '0';
      
      // Reset price inputs
      document.getElementById('min-price').value = '';
      document.getElementById('max-price').value = '';
      
      // Apply filters (which will now be empty)
      applyFilters();
    }

    function initCategoryEventListeners() {
      // Sort select change
      const sortSelect = document.getElementById('sort-select');
      sortSelect.addEventListener('change', function() {
        // Get current URL and update the sort parameter
        const url = new URL(window.location.href);
        url.searchParams.set('sort', this.value);
        
        // Update browser history without reloading the page
        window.history.pushState({}, '', url.toString());
        
        // Apply the sort
        const urlParams = new URLSearchParams(window.location.search);
        const categoryId = urlParams.get('id');
        const searchQuery = urlParams.get('search');
        
        // Call applyFilters to reload products with current filters and new sort
        applyFilters();
      });
      
      // Search form submission
      const searchForm = document.getElementById('search-form');
      searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const searchInput = document.getElementById('search-input');
        if (searchInput && searchInput.value.trim().length > 0) {
          // Get current URL and update the search parameter
          const url = new URL(window.location.href);
          url.searchParams.set('search', searchInput.value.trim());
          
          // Navigate to the new URL
          window.location.href = url.toString();
        }
      });
    }
  </script>
</body>
</html>